# Changelog

本文件记录项目的主要更改。

## [1.1.0] - 2026-01-11

### ✨ 新增功能
- **Mihomo内核更新**: 更新至v1.19.18
- **停止检测功能**: 新增"停止"按钮，允许用户随时中断正在进行的检测任务
- **Request ID 机制**: 为每次检测生成唯一标识符，防止取消操作的竞态条件
- **共享设备数显示**: Ping0 检测结果现在会在日志中显示"共享: N"信息
- **自引用 URL 解包**: 自动识别并解包 `http://my-site/check?url=...` 格式的递归链接
- **状态流程文档**: 新增 `docs/job_state_diagram.md`，包含完整的 Mermaid 状态图

### 🐛 问题修复

- **缓存绕过逻辑**: 修复 `max_age=0` 时仍可能走缓存的问题
- **取消后重启失败**: 修复取消任务后再次点击"开始检测"无响应的问题
- **旧任务干扰新任务**: 新任务提交时会自动取消旧任务，避免状态混乱
- **日志旧标记混淆**: "Checking: ..." 日志现在会过滤掉旧的 `【...】` 标记
- **重复方法定义**: 修复 `job_manager.py` 中 `submit_job` 方法重复定义的问题
- **超时参数传递**: 修复前端"请求超时"设置未传递到订阅下载阶段的问题

### 🎨 UI/UX 改进

- **按钮防抖**: "开始检测"按钮点击后变灰并显示加载动画，防止重复点击
- **日志自动清理**: 开始新检测时自动清空旧日志
- **结果区域隐藏**: 开始新检测时自动隐藏之前的下载链接区域
- **设置项描述优化**: 改进"跳过关键词"、"缓存时间"、"请求超时"的中文描述

### 📝 文档

- 新增 `docs/job_state_diagram.md` - 任务生命周期状态图
- 新增 `CHANGELOG.md` - 版本变更日志

---

## [1.0.0] - 初始版本

- 基于 Clash Meta (Mihomo) 的 IP 风险检测
- FastAPI 后端 + Tailwind CSS 前端
- Docker 一键部署
- 智能缓存与任务队列
